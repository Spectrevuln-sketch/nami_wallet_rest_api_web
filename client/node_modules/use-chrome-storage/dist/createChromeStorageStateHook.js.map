{"version":3,"file":"createChromeStorageStateHook.js","sources":["../src/createChromeStorageStateHook.js","../src/useChromeStorage.js","../src/storage.js"],"sourcesContent":["import {useCallback, useEffect} from 'react';\r\nimport useChromeStorage from './useChromeStorage';\r\n\r\n\r\nexport default function createChromeStorageStateHook(key, initialValue, storageArea) {\r\n    const consumers = [];\r\n\r\n    return function useCreateChromeStorageHook() {\r\n        const [value, setValue, isPersistent, error] = useChromeStorage(key, initialValue, storageArea);\r\n\r\n        const setValueAll = useCallback(newValue => {\r\n            for (const consumer of consumers) {\r\n                consumer(newValue);\r\n            }\r\n        }, []);\r\n\r\n        useEffect(() => {\r\n            consumers.push(setValue);\r\n            return () => {\r\n                consumers.splice(consumers.indexOf(setValue), 1);\r\n            };\r\n        }, [setValue]);\r\n\r\n        return [value, setValueAll, isPersistent, error];\r\n    };\r\n}\r\n","import {useCallback, useEffect, useState} from 'react';\r\nimport {storage} from './storage';\r\n\r\n\r\n/**\r\n * Basic hook for storage\r\n * @param {string} key\r\n * @param {*} initialValue\r\n * @param {'local'|'sync'} storageArea\r\n * @returns {[*, function(*= any): void, boolean, string]}\r\n */\r\nexport default function useChromeStorage(key, initialValue, storageArea) {\r\n    const [INITIAL_VALUE] = useState(() => {\r\n        return typeof initialValue === 'function' ? initialValue() : initialValue;\r\n    });\r\n    const [STORAGE_AREA] = useState(storageArea);\r\n    const [state, setState] = useState(INITIAL_VALUE);\r\n    const [isPersistent, setIsPersistent] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        storage.get(key, INITIAL_VALUE, STORAGE_AREA)\r\n            .then(res => {\r\n                setState(res);\r\n                setIsPersistent(true);\r\n                setError('');\r\n            })\r\n            .catch(error => {\r\n                setIsPersistent(false);\r\n                setError(error);\r\n            });\r\n    }, [key, INITIAL_VALUE, STORAGE_AREA]);\r\n\r\n    const updateValue = useCallback((newValue) => {\r\n        const toStore = typeof newValue === 'function' ? newValue(state) : newValue;\r\n        setState(toStore);\r\n        storage.set(key, toStore, STORAGE_AREA)\r\n            .then(() => {\r\n                setIsPersistent(true);\r\n                setError('');\r\n            })\r\n            .catch(error => {\r\n                setIsPersistent(false);\r\n                setError(error);\r\n            });\r\n    }, [STORAGE_AREA, key, state]);\r\n\r\n    useEffect(() => {\r\n        const onChange = (changes, areaName) => {\r\n            if (areaName === STORAGE_AREA && key in changes) {\r\n                setState(changes[key].newValue);\r\n                setIsPersistent(true);\r\n                setError('');\r\n            }\r\n        };\r\n        chrome.storage.onChanged.addListener(onChange);\r\n        return () => {\r\n            chrome.storage.onChanged.removeListener(onChange);\r\n        };\r\n    }, [key, STORAGE_AREA]);\r\n\r\n    return [state, updateValue, isPersistent, error];\r\n}\r\n","export const storage = {\r\n    get: (key, defaultValue, storageArea) => {\r\n        const keyObj = defaultValue === undefined ? key : {[key]: defaultValue};\r\n        return new Promise((resolve, reject) => {\r\n            chrome.storage[storageArea].get(keyObj, items => {\r\n                const error = chrome.runtime.lastError;\r\n                if (error) return reject(error);\r\n                resolve(items[key]);\r\n            });\r\n        });\r\n    },\r\n    set: (key, value, storageArea) => {\r\n        return new Promise((resolve, reject) => {\r\n            chrome.storage[storageArea].set({[key]: value}, () => {\r\n                const error = chrome.runtime.lastError;\r\n                error ? reject(error) : resolve();\r\n            });\r\n        });\r\n    },\r\n};\r\n"],"names":["createChromeStorageStateHook","key","initialValue","storageArea","consumers","value","setValue","isPersistent","error","INITIAL_VALUE","useState","STORAGE_AREA","state","setState","setIsPersistent","setError","useEffect","defaultValue","keyObj","undefined","[object Object]","Promise","resolve","reject","chrome","storage","get","items","runtime","lastError","then","res","catch","updateValue","useCallback","newValue","toStore","set","onChange","changes","areaName","onChanged","addListener","removeListener","useChromeStorage","setValueAll","consumer","push","splice","indexOf"],"mappings":"0EAIwBA,EAA6BC,EAAKC,EAAcC,GACpE,MAAMC,EAAY,GAElB,kBACI,MAAOC,EAAOC,EAAUC,EAAcC,YCGLP,EAAKC,EAAcC,GACxD,MAAOM,GAAiBC,EAAS,IACE,mBAAjBR,EAA8BA,IAAiBA,IAE1DS,GAAgBD,EAASP,IACzBS,EAAOC,GAAYH,EAASD,IAC5BF,EAAcO,GAAmBJ,GAAS,IAC1CF,EAAOO,GAAYL,EAAS,IAEnCM,EAAU,KCnBL,EAACf,EAAKgB,EAAcd,KACrB,MAAMe,OAA0BC,IAAjBF,EAA6BhB,EAAM,CAACmB,CAACnB,GAAMgB,GAC1D,WAAWI,QAAQ,CAACC,EAASC,KACzBC,OAAOC,QAAQtB,GAAauB,IAAIR,EAAQS,IACpC,MAAMnB,EAAQgB,OAAOI,QAAQC,UAC7B,GAAIrB,EAAO,OAAOe,EAAOf,GACzBc,EAAQK,EAAM1B,SDctBwB,CAAYxB,EAAKQ,EAAeE,GAC3BmB,KAAKC,IACFlB,EAASkB,GACTjB,GAAgB,GAChBC,EAAS,MAEZiB,MAAMxB,IACHM,GAAgB,GAChBC,EAASP,MAElB,CAACP,EAAKQ,EAAeE,IAExB,MAAMsB,EAAcC,EAAaC,IAC7B,MAAMC,EAA8B,mBAAbD,EAA0BA,EAASvB,GAASuB,EACnEtB,EAASuB,GCxBR,EAACnC,EAAKI,EAAOF,QACHkB,QAAQ,CAACC,EAASC,KACzBC,OAAOC,QAAQtB,GAAakC,IAAI,CAACjB,CAACnB,GAAMI,GAAQ,KAC5C,MAAMG,EAAQgB,OAAOI,QAAQC,UAC7BrB,EAAQe,EAAOf,GAASc,QDqBhCG,CAAYxB,EAAKmC,EAASzB,GACrBmB,KAAK,KACFhB,GAAgB,GAChBC,EAAS,MAEZiB,MAAMxB,IACHM,GAAgB,GAChBC,EAASP,MAElB,CAACG,EAAcV,EAAKW,IAgBvB,OAdAI,EAAU,KACN,MAAMsB,EAAW,CAACC,EAASC,KACnBA,IAAa7B,GAAgBV,KAAOsC,IACpC1B,EAAS0B,EAAQtC,GAAKkC,UACtBrB,GAAgB,GAChBC,EAAS,MAIjB,OADAS,OAAOC,QAAQgB,UAAUC,YAAYJ,GAC9B,KACHd,OAAOC,QAAQgB,UAAUE,eAAeL,KAE7C,CAACrC,EAAKU,IAEF,CAACC,EAAOqB,EAAa1B,EAAcC,GDrDSoC,CAAiB3C,EAAKC,EAAcC,GAE7E0C,EAAcX,EAAYC,IAC5B,IAAK,MAAMW,KAAY1C,EACnB0C,EAASX,IAEd,IASH,OAPAnB,EAAU,KACNZ,EAAU2C,KAAKzC,GACR,KACHF,EAAU4C,OAAO5C,EAAU6C,QAAQ3C,GAAW,KAEnD,CAACA,IAEG,CAACD,EAAOwC,EAAatC,EAAcC"}