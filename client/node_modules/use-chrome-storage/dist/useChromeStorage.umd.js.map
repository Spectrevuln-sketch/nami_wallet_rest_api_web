{"version":3,"file":"useChromeStorage.umd.js","sources":["../src/useChromeStorage.js","../src/storage.js"],"sourcesContent":["import {useCallback, useEffect, useState} from 'react';\r\nimport {storage} from './storage';\r\n\r\n\r\n/**\r\n * Basic hook for storage\r\n * @param {string} key\r\n * @param {*} initialValue\r\n * @param {'local'|'sync'} storageArea\r\n * @returns {[*, function(*= any): void, boolean, string]}\r\n */\r\nexport default function useChromeStorage(key, initialValue, storageArea) {\r\n    const [INITIAL_VALUE] = useState(() => {\r\n        return typeof initialValue === 'function' ? initialValue() : initialValue;\r\n    });\r\n    const [STORAGE_AREA] = useState(storageArea);\r\n    const [state, setState] = useState(INITIAL_VALUE);\r\n    const [isPersistent, setIsPersistent] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        storage.get(key, INITIAL_VALUE, STORAGE_AREA)\r\n            .then(res => {\r\n                setState(res);\r\n                setIsPersistent(true);\r\n                setError('');\r\n            })\r\n            .catch(error => {\r\n                setIsPersistent(false);\r\n                setError(error);\r\n            });\r\n    }, [key, INITIAL_VALUE, STORAGE_AREA]);\r\n\r\n    const updateValue = useCallback((newValue) => {\r\n        const toStore = typeof newValue === 'function' ? newValue(state) : newValue;\r\n        setState(toStore);\r\n        storage.set(key, toStore, STORAGE_AREA)\r\n            .then(() => {\r\n                setIsPersistent(true);\r\n                setError('');\r\n            })\r\n            .catch(error => {\r\n                setIsPersistent(false);\r\n                setError(error);\r\n            });\r\n    }, [STORAGE_AREA, key, state]);\r\n\r\n    useEffect(() => {\r\n        const onChange = (changes, areaName) => {\r\n            if (areaName === STORAGE_AREA && key in changes) {\r\n                setState(changes[key].newValue);\r\n                setIsPersistent(true);\r\n                setError('');\r\n            }\r\n        };\r\n        chrome.storage.onChanged.addListener(onChange);\r\n        return () => {\r\n            chrome.storage.onChanged.removeListener(onChange);\r\n        };\r\n    }, [key, STORAGE_AREA]);\r\n\r\n    return [state, updateValue, isPersistent, error];\r\n}\r\n","export const storage = {\r\n    get: (key, defaultValue, storageArea) => {\r\n        const keyObj = defaultValue === undefined ? key : {[key]: defaultValue};\r\n        return new Promise((resolve, reject) => {\r\n            chrome.storage[storageArea].get(keyObj, items => {\r\n                const error = chrome.runtime.lastError;\r\n                if (error) return reject(error);\r\n                resolve(items[key]);\r\n            });\r\n        });\r\n    },\r\n    set: (key, value, storageArea) => {\r\n        return new Promise((resolve, reject) => {\r\n            chrome.storage[storageArea].set({[key]: value}, () => {\r\n                const error = chrome.runtime.lastError;\r\n                error ? reject(error) : resolve();\r\n            });\r\n        });\r\n    },\r\n};\r\n"],"names":["key","initialValue","storageArea","INITIAL_VALUE","useState","STORAGE_AREA","state","setState","isPersistent","setIsPersistent","error","setError","useEffect","defaultValue","keyObj","undefined","[object Object]","Promise","resolve","reject","chrome","storage","get","items","runtime","lastError","then","res","catch","updateValue","useCallback","newValue","toStore","value","set","onChange","changes","areaName","onChanged","addListener","removeListener"],"mappings":"qRAWyCA,EAAKC,EAAcC,GACxD,MAAOC,GAAiBC,WAAS,IACE,mBAAjBH,EAA8BA,IAAiBA,IAE1DI,GAAgBD,WAASF,IACzBI,EAAOC,GAAYH,WAASD,IAC5BK,EAAcC,GAAmBL,YAAS,IAC1CM,EAAOC,GAAYP,WAAS,IAEnCQ,YAAU,KCnBL,EAACZ,EAAKa,EAAcX,KACrB,MAAMY,OAA0BC,IAAjBF,EAA6Bb,EAAM,CAACgB,CAAChB,GAAMa,GAC1D,WAAWI,QAAQ,CAACC,EAASC,KACzBC,OAAOC,QAAQnB,GAAaoB,IAAIR,EAAQS,IACpC,MAAMb,EAAQU,OAAOI,QAAQC,UAC7B,GAAIf,EAAO,OAAOS,EAAOT,GACzBQ,EAAQK,EAAMvB,SDctBqB,CAAYrB,EAAKG,EAAeE,GAC3BqB,KAAKC,IACFpB,EAASoB,GACTlB,GAAgB,GAChBE,EAAS,MAEZiB,MAAMlB,IACHD,GAAgB,GAChBE,EAASD,MAElB,CAACV,EAAKG,EAAeE,IAExB,MAAMwB,EAAcC,cAAaC,IAC7B,MAAMC,EAA8B,mBAAbD,EAA0BA,EAASzB,GAASyB,EACnExB,EAASyB,GCxBR,EAAChC,EAAKiC,EAAO/B,QACHe,QAAQ,CAACC,EAASC,KACzBC,OAAOC,QAAQnB,GAAagC,IAAI,CAAClB,CAAChB,GAAMiC,GAAQ,KAC5C,MAAMvB,EAAQU,OAAOI,QAAQC,UAC7Bf,EAAQS,EAAOT,GAASQ,QDqBhCG,CAAYrB,EAAKgC,EAAS3B,GACrBqB,KAAK,KACFjB,GAAgB,GAChBE,EAAS,MAEZiB,MAAMlB,IACHD,GAAgB,GAChBE,EAASD,MAElB,CAACL,EAAcL,EAAKM,IAgBvB,OAdAM,YAAU,KACN,MAAMuB,EAAW,CAACC,EAASC,KACnBA,IAAahC,GAAgBL,KAAOoC,IACpC7B,EAAS6B,EAAQpC,GAAK+B,UACtBtB,GAAgB,GAChBE,EAAS,MAIjB,OADAS,OAAOC,QAAQiB,UAAUC,YAAYJ,GAC9B,KACHf,OAAOC,QAAQiB,UAAUE,eAAeL,KAE7C,CAACnC,EAAKK,IAEF,CAACC,EAAOuB,EAAarB,EAAcE"}